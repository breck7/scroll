{"version":3,"file":"before.js","sourceRoot":"","sources":["../../src/before.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,eAAe,EAAE,MAAM,kBAAkB,CAAA;AAClD,OAAO,EAAE,OAAO,EAAE,MAAM,MAAM,CAAA;AAE9B,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAA;AAE7B,MAAM,CAAC,MAAM,SAAS,GAAG,CACvB,CAAM,EACN,IAAc,EACd,MAAoB,EACpB,EAAE;IACF,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;IACnC,IAAI,MAAM,EAAE;QACV,CAAC,CAAC,MAAM,CACN,KAAK,IAAI,EAAE,CACT,IAAI,OAAO,CAAO,GAAG,CAAC,EAAE;YACtB,eAAe,CACb,IAAI,EACJ,CAAC,GAAG,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,EAC1B,CAAC,IAAI,EAAE,MAAM,EAAE,EAAE;gBACf,GAAG,EAAE,CAAA;gBACL,IAAI,IAAI,IAAI,MAAM;oBAAE,OAAM;gBAC1B,OAAO,KAAK,CAAA;YACd,CAAC,CACF,CAAA;QACH,CAAC,CAAC,CACL,CAAA;QACD,OAAO,OAAO,CAAC,MAAM,CAAC,CAAA;KACvB;AACH,CAAC,CAAA","sourcesContent":["import { LoadedConfig } from '@tapjs/config'\nimport { TAP } from '@tapjs/core'\nimport { foregroundChild } from 'foreground-child'\nimport { resolve } from 'path'\n\nconst node = process.execPath\n\nexport const runBefore = (\n  t: TAP,\n  argv: string[],\n  config: LoadedConfig\n) => {\n  const before = config.get('before')\n  if (before) {\n    t.before(\n      async () =>\n        new Promise<void>(res => {\n          foregroundChild(\n            node,\n            [...argv, resolve(before)],\n            (code, signal) => {\n              res()\n              if (code || signal) return\n              return false\n            }\n          )\n        })\n    )\n    return resolve(before)\n  }\n}\n"]}