{"version":3,"file":"stdio.js","sourceRoot":"","sources":["../../src/stdio.ts"],"names":[],"mappings":";;;AACA,qDAA4C;AAErC,MAAM,cAAc,GAAG,CAC5B,MAA2B,EAC3B,OAAuB,EACvB,KAA0B,EAC1B,EAAE;IACF,MAAM,KAAK,GAAG,CAAC,CAAkB,EAAE,EAAE;QACnC,MAAM,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,CAAA;QACzB,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,IAAA,0BAAS,EAAC,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,CAAA;IACjD,CAAC,CAAA;IACD,MAAM,IAAI,GAAG,OAAO,CAAC,KAAK,CAAC,CAAA;IAC3B,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,KAAK,EAAE;QACpC,YAAY,EAAE,IAAI;QAClB,UAAU,EAAE,IAAI;QAChB,QAAQ,EAAE,IAAI;QACd,+DAA+D;QAC/D,mEAAmE;QACnE,KAAK,EAAE,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;YAClD,KAAK,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE;SACxB,CAAC;KACH,CAAC,CAAA;AACJ,CAAC,CAAA;AApBY,QAAA,cAAc,kBAoB1B","sourcesContent":["import { TestStreamSerialize } from '@tapjs/error-serdes'\nimport { locFromAt } from './loc-from-at.js'\n\nexport const serializeStdio = (\n  stream: TestStreamSerialize,\n  process: NodeJS.Process,\n  which: 'stdout' | 'stderr'\n) => {\n  const write = (m: Buffer | string) => {\n    const message = String(m)\n    stream[which]({ ...locFromAt(write), message })\n  }\n  const orig = process[which]\n  Object.defineProperty(process, which, {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    // create a new object that inherits from the original, but has\n    // a write() method that captures a test:stderr/test:stdout message\n    value: Object.defineProperties(Object.create(orig), {\n      write: { value: write },\n    }),\n  })\n}\n"]}