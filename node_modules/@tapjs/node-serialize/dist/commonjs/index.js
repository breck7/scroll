"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.plugin = void 0;
const core_1 = require("@tapjs/core");
const serialize_js_1 = require("./serialize.js");
let serialized = false;
const plugin = t => {
    if (t.name === 'TAP' &&
        !t.parent &&
        core_1.env.NODE_TEST_CONTEXT === 'child-v8' &&
        !serialized) {
        // make sure we don't serialize anything else in this process
        serialized = true;
        core_1.env.NODE_TEST_CONTEXT = 'child';
        (0, serialize_js_1.serialize)(t);
    }
    return {};
};
exports.plugin = plugin;
//# sourceMappingURL=index.js.map